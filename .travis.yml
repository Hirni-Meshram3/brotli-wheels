env:
  global:
    # directory containing the project source
    - REPO_DIR=src/brotli
    # Commit from your-project that you want to build
    - BUILD_COMMIT=v1.0.7
    # pip dependencies to _build_ project
    - BUILD_DEPENDS=
    # pip dependencies to _test_ project
    - TEST_DEPENDS=
    - PLAT=x86_64
    - UNICODE_WIDTH=32
    # PyPI credentials
    - TWINE_USERNAME=anthrotype
    - secure: Bk9RlyRm7ZajhfYm/RCd+h1bH5O0sdTU2jBv0jIhHlwiM2WuPANo0tJqNRYCV9orkFpZ80o8+Z4KIiUO1WkYrz3baE5SeRggWeE3sX3NRMOwQa/xXpfcsjMx9QgrqTasSMDTHpcBsoWgsXJJVmtx2e9AhEeYbNB6cWNkpmD8laSBiQGe1GlNo1AoqXIJqVsAfVAh3UWfvud9YtawkgWPDLXcoMaXdXiiMXvtp662Yg3rcPVTcJSovweQqQfCK+H6960WM6mXRJAsHRftYqrWmyLUdBzvhYGq5Hdv68z/C3VGI+MBJIoiQctsH/lbdKdxydLMPZCeff0+dzoufiNgxyEQk5AcAybxJLgpawzNMx2poCvrcVLqFK8u2jU3BXZMAztAxt/lTyS2fc71AMrFiunjbnReke3Gut8lsjxOugfwe4L3k+WZehmznl0Xyd8YRA8fQABwfNe3Rzz9G2+Sq4yDfalE/CWKCjCPaL7ro/g87o9qEcqGDnujpPCyOSVskNZHPn+xMoSzkwY0wmDyIXsc6ZnTj/P84VeY6OIhY+DjtjHMUjH1KaVMr9dXPiPZ7COl2myIQMEsGV3Oqbf9963RQj2zSRcr2JYu8dbpgMDH+MycgsKi10wPLdVdeXq5DM+7tVwkB8+YVKfg9ymA0K/LzTt+4V4Ga9UkPjdhRbg=

language: generic
dist: xenial
services: docker

matrix:
  include:
    - os: linux
      env: MB_PYTHON_VERSION=2.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - UNICODE_WIDTH=16
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - PLAT=i686
        - UNICODE_WIDTH=16
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.4
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.4
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
        - BUILD_SDIST=true
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.7
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.8
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.8
        - PLAT=i686
    - os: osx
      env:
        - MB_PYTHON_VERSION=2.7
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.4
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.5
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.6
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.7
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.8

before_install:
  - source multibuild/common_utils.sh
  - source multibuild/travis_steps.sh
  - before_install

install:
  - clean_code $REPO_DIR $BUILD_COMMIT
  - build_wheel $REPO_DIR $PLAT

script:
  - install_run $PLAT

after_success:
  # if tagged, create the source distribution and upload to PyPI
  - |
    if [ -n "$TRAVIS_TAG" ]; then
      cd ${TRAVIS_BUILD_DIR}
      source venv/bin/activate
      pip install twine
      if [ "$BUILD_SDIST" == true ]; then
        pip install -U setuptools
        (cd $REPO_DIR && python setup.py sdist --formats=zip)
        twine upload $REPO_DIR/dist/*.zip
      fi
      twine upload wheelhouse/*.whl
    fi
